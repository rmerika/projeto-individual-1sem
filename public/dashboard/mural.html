<!DOCTYPE html>
<html lang="pt-br">

<head>
    <link rel="shortcut icon" href="../assets/icon/favicon.ico" type="image/x-icon">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>INGuitar | Guitarras</title>

    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="./dashboards.css">
    <script src="../js/funcoes.js"></script>

    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link
        href="https://fonts.googleapis.com/css2?family=Exo+2:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
        rel="stylesheet">
</head>

<body onload="validarSessao(), atualizarFeed()" style="background-color: #161618;">
    <!-- <body onload="validarSessao()"> -->

    <div class="janela">


        <div class="header-left">

            <h1><span style="color: #F4971E;">IN</span>Guitar</h1>

            <div class="hello">
                <h3>Olá, <span id="b_usuario">usuário</span>!</h3>
            </div>

            <div class="btn-nav">
                <h3>Guitarras</h3>
            </div>

            <div class="btn-nav-white">
                <a href="cards.html">
                    <h3>Médias</h3>
                </a>
            </div>

            <div class="btn-nav-white">
                <a href="./dashboard.html">
                    <h3>Gráfico</h3>
                </a>
            </div>



            <div class="btn-logout" onclick="limparSessao()">
                <h3>Sair</h3>
            </div>

        </div>
        <div class="guitarras">
            <div class="simulador">
                <div class="container">
                    <h3>Gibson ES - 150</h3>
                    <div class="imgtxt">
                    <span class="texto">
                       
                        Em 1936, a Gibson que era a fábrica de violões até então, lança a Gibson ES-150, primeiro modelo
                        de
                        guitarra semi-acústica. Diferente dos violões acústicos existentes nessa época a Gibson ES-150
                        tinha
                        um som mais forte e alto devido ao sistema de captação. Isso, fez com que ela se tornasse
                        extremamente
                        popular entre as bandas de Jazz desse período, ocupando uma posição mais significativa dentro do
                        conjunto de instrumentos.
                    </span>
                    <img src="../assets/imgs/simulador1.jpg" style="width: 163px; height: 163px;">
                </div>
                    <br>
                    <b>Música tocada com Gibson ES - 150:</b>
                    <br>
                    <iframe style="border-radius:12px"
                        src="https://open.spotify.com/embed/track/651OpXqL6blBV0KOswQ2yh?utm_source=generator&theme=0"
                        width="100%" height="80" frameBorder="0" allowfullscreen=""
                        allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture"></iframe>
                </div>
            </div>

            <div class="simulador2">
                <div class="container2">
                    <h3>Telecaster</h3>
                    <div class="imgtxt">

                        <span class="texto">
                            Na década de 40 surge a FENDER e seus experimentos na construção de guitarras. Leo Fender
                            (fundados da
                            empresa)
                            e Paul Bigsby (mecânico que mais tarde inventou a ponte com alavanca) desenvolveram um
                            instrumento com
                            corpo sólido em 1947.
                            No ano seguinte uma guitarra com corpo sólido e 2 captadores começava a ser comercializada.
                            Era a
                            Broadcaster que depois ganhou o nome de Telecaster.
                        </span>
                        <img src="../assets/imgs/simulador2.jpg" style="width: 163px; height: 163px;">
                        </div>
                <br><br>
                <b>Música tocada com Telecaster:</b>
                <br><br>
                <iframe style="border-radius:12px"
                    src="https://open.spotify.com/embed/track/04AJcjNnmmnOwUdbFUj5Hv?utm_source=generator&theme=0"
                    width="100%" height="80" frameBorder="0" allowfullscreen=""
                    allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture"></iframe>

            </div>
        </div>
            
            <div class="simulador3">
                <div class="container3">
                    <h3>Gibson Les Paul</h3>
                    <div class="imgtxt">
                        
                        <span class="texto">
                            Nos anos 1950 a Gibson estava ficando para trás da Fender, pois ainda não havia produzido
                        instruentos
                        com corpo sólido. Após
                        o lançamento da Telecaster (Fender) a Gibson voltou atrás aderindo ao projeto da LOG feita pelo
                        guitarrista Les Paul.
                        Ele aprimorou o projeto e um novo modelo de guitarra passou a ser fabricado. Lester William
                        Polfus
                        exigiu que a empresa colocasse
                        o nome do modelo de LES PAUL, a Gibson aceitou e a primeira Gibson Les Paul foi lançada em 1952
                        com o
                        acabamento dourado, ficando conhecida como Gold Top
                        </span>
                        <img src="../assets/imgs/simulador3.jpg" style="width: 163px; height: 163px;">
                    </div>
                <br><br>
                <b>Música tocada com Gibson Les Paul:</b>
                <br><br>
                <iframe style="border-radius:12px"
                    src="https://open.spotify.com/embed/track/7o2CTH4ctstm8TNelqjb51?utm_source=generator&theme=0"
                    width="100%" height="80" frameBorder="0" allowfullscreen=""
                    allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture"></iframe>

            </div>
        </div>

            <!-- MODAL -->
            <!-- <div id="div_modal" class="div-modal">
                <div id="modal_backdrop" onclick="fecharModal()" class="modal-backdrop">
                </div>
                <div id="modal_container" class="modal-container">
                    <button class="btn-fechar-modal" onclick="fecharModal()">X</button>
                </div>
            </div> -->
            
            <!-- AGUARDAR -->
            <!-- <div id="div_aguardar" class="div-aguardar">
                <img src="./assets/aguarde-pink3.gif" id="img_aguarde">
            </div>  -->

        </div>
    </div>
    


    
</body>

</html>

<script>

    b_usuario.innerHTML = sessionStorage.NOME_USUARIO;

    function limparFormulario() {
        document.getElementById("form_postagem").reset();
    }

    function publicar() {
        var idUsuario = sessionStorage.ID_USUARIO;

        var corpo = {
            titulo: form_postagem.titulo.value,
            descricao: form_postagem.descricao.value
        }

        fetch(`/avisos/publicar/${idUsuario}`, {
            method: "post",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify(corpo)
        }).then(function (resposta) {

            console.log("resposta: ", resposta);

            if (resposta.ok) {
                window.alert("Post realizado com sucesso pelo usuario de ID: " + idUsuario + "!");
                window.location = "/dashboard/mural.html";
                limparFormulario();
                finalizarAguardar();
            } else if (resposta.status == 404) {
                window.alert("Deu 404!");
            } else {
                throw ("Houve um erro ao tentar realizar a postagem! Código da resposta: " + resposta.status);
            }
        }).catch(function (resposta) {
            console.log(`#ERRO: ${resposta}`);
            finalizarAguardar();
        });

        return false;

    }

    function editar(idAviso) {
        sessionStorage.ID_POSTAGEM_EDITANDO = idAviso;
        console.log("cliquei em editar - " + idAviso);
        window.alert("Você será redirecionado à página de edição do aviso de id número: " + idAviso);
        window.location = "/dashboard/edicao-aviso.html"

    }

    function deletar(idAviso) {
        console.log("Criar função de apagar post escolhido - ID" + idAviso);
        fetch(`/avisos/deletar/${idAviso}`, {
            method: "DELETE",
            headers: {
                "Content-Type": "application/json"
            }
        }).then(function (resposta) {

            if (resposta.ok) {
                window.alert("Post deletado com sucesso pelo usuario de email: " + sessionStorage.getItem("EMAIL_USUARIO") + "!");
                window.location = "/dashboard/mural.html"
            } else if (resposta.status == 404) {
                window.alert("Deu 404!");
            } else {
                throw ("Houve um erro ao tentar realizar a postagem! Código da resposta: " + resposta.status);
            }
        }).catch(function (resposta) {
            console.log(`#ERRO: ${resposta}`);
        });
    }

    function atualizarFeed() {
        //aguardar();
        fetch("/avisos/listar").then(function (resposta) {
            if (resposta.ok) {
                if (resposta.status == 204) {
                    var feed = document.getElementById("feed_container");
                    var mensagem = document.createElement("span");
                    mensagem.innerHTML = "Nenhum resultado encontrado."
                    feed.appendChild(mensagem);
                    throw "Nenhum resultado encontrado!!";
                }

                resposta.json().then(function (resposta) {
                    console.log("Dados recebidos: ", JSON.stringify(resposta));

                    var feed = document.getElementById("feed_container");
                    feed.innerHTML = "";
                    for (let i = 0; i < resposta.length; i++) {
                        var publicacao = resposta[i];

                        // criando e manipulando elementos do HTML via JavaScript
                        var divPublicacao = document.createElement("div");
                        var spanID = document.createElement("span");
                        var spanTitulo = document.createElement("span");
                        var spanNome = document.createElement("span");
                        var divDescricao = document.createElement("div");
                        var divButtons = document.createElement("div");
                        var btnEditar = document.createElement("button");
                        var btnDeletar = document.createElement("button");


                        spanID.innerHTML = "ID: <b>" + publicacao.idAviso + "</b>";
                        spanTitulo.innerHTML = "Título: <b>" + publicacao.titulo + "</b>";
                        spanNome.innerHTML = "Autor: <b>" + publicacao.nome + "</b>";
                        divDescricao.innerHTML = "Descrição: <b>" + publicacao.descricao + "</b>";
                        btnEditar.innerHTML = "Editar";
                        btnDeletar.innerHTML = "Deletar";

                        divPublicacao.className = "publicacao";
                        spanTitulo.id = "inputNumero" + publicacao.idAviso;
                        spanNome.className = "publicacao-nome";
                        spanTitulo.className = "publicacao-titulo";
                        divDescricao.className = "publicacao-descricao";

                        divButtons.className = "div-buttons"

                        btnEditar.className = "publicacao-btn-editar"
                        btnEditar.id = "btnEditar" + publicacao.idAviso;
                        btnEditar.setAttribute("onclick", `editar(${publicacao.idAviso})`);

                        btnDeletar.className = "publicacao-btn-editar"
                        btnDeletar.id = "btnDeletar" + publicacao.idAviso;
                        btnDeletar.setAttribute("onclick", `deletar(${publicacao.idAviso})`);

                        divPublicacao.appendChild(spanID);
                        divPublicacao.appendChild(spanNome);
                        divPublicacao.appendChild(spanTitulo);
                        divPublicacao.appendChild(divDescricao);
                        divPublicacao.appendChild(divButtons);
                        divButtons.appendChild(btnEditar);
                        divButtons.appendChild(btnDeletar);
                        feed.appendChild(divPublicacao);
                    }

                    finalizarAguardar();
                });
            } else {
                throw ('Houve um erro na API!');
            }
        }).catch(function (resposta) {
            console.error(resposta);
            finalizarAguardar();
        });
    }

    function testar() {
        aguardar();

        var formulario = new URLSearchParams(new FormData(document.getElementById("form_postagem")));

        var divResultado = document.getElementById("div_feed");

        divResultado.appendChild(document.createTextNode(formulario.get("descricao")));
        divResultado.innerHTML = formulario.get("descricao");

        finalizarAguardar();

        return false;
    }

</script>